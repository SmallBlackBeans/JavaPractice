类似的分布式框架  
Dubbo 阿里产品
Consul Http/DNS
代码示例  
> 关闭了集群功能，只运行server1注册中心即可，然后运行服务提供者provider,然后就可以调用服务和开启监控了。

#### 应用演变
##### 单应用架构
##### 服务化架构 SOA
##### 微服务架构
> 微服务强调每个微服务都有自己独立的运行空间，包括数据库资源.

<div align="center"><img src="./resources/SpringCloud框架.jpg" width="600"/></div><br>

##### 几种服务调用的区别
RPC：所谓的远程过程调用 (面向方法)

SOA：所谓的面向服务的架构(面向消息)

REST：所谓的 Representational state transfer (面向资源)

#### Eureka 服务注册发现中心
server1 server2 为注册中心集群  
provider 为服务提供者  
consumer为服务消费者  

<div align="center"><img src="./resources/Eureka-client与Spring Cloud映射图.png" width="600"/></div><br>

服务注册与发现

#### CAP 原则
分布式系统  
- 一致性（C）：在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）

- 可用性（A）：在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数据更新具备高可用性）

- 分区容错性（P）：以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。

#### zookeeper 与 eureka 区别
Zookeeper通过选举策略保证数据的一致性，(选举期间不可用30-120s)但缺失了可用性(AP);  
Eureka由于服务独立运行，通过心跳等通信策略进行数据同步，存在数据不一致性，但保证了服务的可用性(CP);

总结：  
作为服务注册中心而言，可用性原则是比数据一致性更重要的，Eureka可以很好的应对因网络故障导致节点失去联系的情况。

- 若是一台服务器，部署多个Eureka server服务时，设置每个服务
的hostname不一致，同时要设置eureka.instance.prefer-ip-address为false，不使用IP地址进行注册。
- 若是多台服务器部署时，设置hostname为本机的ip地址，可使用spring.cloud.client.ip-address变量进行赋值。同时设置eureka.instance.prefer-ip-address为true。这样的话，客户端使用ip进行连接就方便了，不然还要去配置host有点坑了。
- 对于客户端的defaultZone建议还是配置多个注册中心地址。就算本身集群模式无效，好歹其中一个不可用了，还能连其他的注册中心呀。


#### 负载均衡
##### 客户端负载均衡 
Ribbon @LoadBalanced

##### 服务器负载均衡
Nginx 硬件F5 HA Proxy

#### 注解调用Api
Feign是Netflix开发的声明式、模块化的HTTP客户端,帮助我们更好更快的便捷、优雅地调用HTTP API。

#### 服务容错保护
Hystrix 熔断器
Hystrix是有Netflix开源的一个延迟和容错库，
用于隔离访问远程系统、服务或第三方库，防止级联失败，从而提升系统的可用性和容错性。  
一个服务中针对调用其他的每一个服务都维护一个线程池，隔离开来，互不影响各个服务的调用。

##### 状态
- 关闭状态    
当熔断器处于关闭状态时，请求是可以被放行的；    
当熔断器统计的失败次数触发开关时，转为打开状态。
    
- 打开状态
当熔断器处于打开状态时，所有请求都是不被放行的，直接返回失败；   
只有在经过一个设定的时间窗口周期后，熔断器才会转换到半开状态

- 半开状态  
当熔断器处于半开状态时，当前只能有一个请求被放行；  
这个被放行的请求获得远端服务的响应后，假如是成功的，熔断器转换为关闭状态，否则转换到打开状态。


##### 熔断监控面板
Hystrix DashBoard
<div align="center"><img src="./resources/熔断监控.jpg" width="600"/></div><br>


##### 聚合监控
Turbine 数据聚合


### 分布式配置中心
传统的配置文件方式和数据库的方式：
- 安全性：配置跟随源代码保存在代码库中，容易造成配置泄漏；

- 时效性：修改配置，需要重启服务才能生效；

- 局限性：无法支持动态调整：例如日志开关、功能开关；



### 路由服务
#### 微服务网关
##### Spring Cloud Zuul:  
Zuul的主要功能是路由转发和过滤器,基于JVM的路由器和服务器端负载均衡器.
  

##### Kong 
基于OpenResty的 API 网关服务和网关服务管理层。  
##### Spring Cloud Gateway


### 微服务文档功能
swagger实现自动化聚合

#### 认证鉴权
shiro spring-security jwt(json web tokens)

#### 响应框架
[RxJava](https://github.com/ReactiveX/RxJava)  
[Reactor](http://blog.51cto.com/liukang/2090163)

#### 文章阅读
[微服务架构如何保障双11狂欢下的99.99%高可用](https://juejin.im/post/5be99a68e51d4511a8090440)
[分布式调度中心进阶](http://blog.springcloud.cn/sc/wk4/)
[分布式ID生成服务](http://blog.springcloud.cn/sc/wk5/)

